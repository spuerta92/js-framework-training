#!/bin/bash

# Update system and install necessary packages
sudo yum update -y
sudo yum upgrade -y

# Install git, curl, and Node.js
sudo yum install git curl -y

# Install Node.js if not already installed
if ! command -v node &> /dev/null
then
	curl -sL https://rpm.nodesource.com/setup_18.x | sudo bash -
	sudo yum install -y nodejs
fi

# Navigate to project directory or clone repo if it doesn't exist
PROJECT_DIR="js-framework-training/VUE/iam-project-vue"
REPO_URL="https://github.com/spuerta92/js-framework-training.git"

if [ ! -d "$PROJECT_DIR" ]; then
    echo "Cloning repository..."
    git clone $REPO_URL $PROJECT_DIR
fi

# Go to the project directory
cd $PROJECT_DIR

# Pull the latest changes from the repository
echo "Pulling latest changes..."
git checkout vue-workspace
git pull origin vue-workspace

# Install npm dependencies
echo "Installing npm dependencies..."
npm install

# Build the Vue.js project
echo "Building the project..."
npm run build

# Install 'serve' globally to serve the production build (if not installed)
if ! command -v serve &> /dev/null
then
    sudo npm install -g serve
fi

sudo yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm

# Serve the project on default port 3000 (or another port)
echo "Starting the Vue.js application..."
serve -s dist -n